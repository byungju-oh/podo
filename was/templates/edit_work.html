<!-- was/templates/edit_work.html (ìƒˆ íŒŒì¼ ìƒì„±) -->

{% extends "base.html" %}

{% block title %}í”„ë¡œì íŠ¸ ìˆ˜ì • - ê´€ë¦¬ì{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="h2 mb-1">í”„ë¡œì íŠ¸ ìˆ˜ì •</h1>
                    <p class="text-muted mb-0">{{ project.title }} í”„ë¡œì íŠ¸ ì •ë³´ë¥¼ ìˆ˜ì •í•©ë‹ˆë‹¤</p>
                </div>
                <a href="{{ url_for('admin') }}" class="btn btn-outline-secondary">
                    <i class="fas fa-arrow-left me-1"></i>ê´€ë¦¬ìë¡œ ëŒì•„ê°€ê¸°
                </a>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Main Form -->
        <div class="col-lg-8">
            <div class="card shadow">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-edit me-2"></i>í”„ë¡œì íŠ¸ ì •ë³´ ìˆ˜ì •
                    </h5>
                </div>
                <div class="card-body">
                    <form id="editProjectForm" method="POST" enctype="multipart/form-data" action="{{ url_for('edit_work', work_id=project.id) }}">
                        <!-- CSRF í† í° -->
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                        
                        <!-- ê¸°ë³¸ ì •ë³´ ì„¹ì…˜ -->
                        <div class="form-section mb-4">
                            <div class="section-header mb-3">
                                <h6 class="text-primary mb-0">
                                    <i class="fas fa-info-circle me-1"></i>ê¸°ë³¸ ì •ë³´
                                </h6>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-8 mb-3">
                                    <label for="title" class="form-label">í”„ë¡œì íŠ¸ëª… *</label>
                                    <input type="text" class="form-control" id="title" name="title" 
                                           value="{{ project.title }}" required>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="project_type" class="form-label">í”„ë¡œì íŠ¸ ìœ í˜• *</label>
                                    <select class="form-select" id="project_type" name="project_type" required>
                                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                        <option value="tech" {{ 'selected' if project.project_type == 'tech' }}>ì›¹/ì•± ê°œë°œ</option>
                                        <option value="infra" {{ 'selected' if project.project_type == 'infra' }}>ì¸í”„ë¼/DevOps</option>
                                        <option value="data" {{ 'selected' if project.project_type == 'data' }}>ë°ì´í„° ë¶„ì„</option>
                                        <option value="ai" {{ 'selected' if project.project_type == 'ai' }}>AI/ML</option>
                                        <option value="art" {{ 'selected' if project.project_type == 'art' }}>ì•„íŠ¸ì›Œí¬</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="category" class="form-label">ì„¸ë¶€ ì¹´í…Œê³ ë¦¬</label>
                                    <input type="text" class="form-control" id="category" name="category" 
                                           value="{{ project.category or '' }}">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="my_role" class="form-label">ë‚´ ì—­í• </label>
                                    <input type="text" class="form-control" id="my_role" name="my_role" 
                                           value="{{ project.my_role or '' }}">
                                </div>
                            </div>
                        </div>

                        <!-- í”„ë¡œì íŠ¸ ì„¤ëª… ì„¹ì…˜ -->
                        <div class="form-section mb-4">
                            <div class="section-header mb-3">
                                <h6 class="text-primary mb-0">
                                    <i class="fas fa-file-alt me-1"></i>í”„ë¡œì íŠ¸ ì„¤ëª…
                                </h6>
                            </div>
                            
                            <div class="mb-3">
                                <label for="description" class="form-label">ê°„ë‹¨í•œ ì„¤ëª… *</label>
                                <textarea class="form-control" id="description" name="description" rows="3" required>{{ project.description }}</textarea>
                            </div>
                            
                            <div class="mb-3">
                                <label for="detailed_description" class="form-label">ìƒì„¸ ì„¤ëª…</label>
                                <textarea class="form-control" id="detailed_description" name="detailed_description" rows="6">{{ project.detailed_description or '' }}</textarea>
                            </div>
                        </div>

                        <!-- ê¸°ìˆ  ìŠ¤íƒ ì„¹ì…˜ -->
                        <div class="form-section mb-4">
                            <div class="section-header mb-3">
                                <h6 class="text-primary mb-0">
                                    <i class="fas fa-code me-1"></i>ê¸°ìˆ  ìŠ¤íƒ
                                </h6>
                            </div>
                            
                            <div class="mb-3">
                                <label for="tech_stack" class="form-label">ì‚¬ìš© ê¸°ìˆ </label>
                                <input type="text" class="form-control" id="tech_stack" name="tech_stack" 
                                       value="{{ project.tech_stack or '' }}"
                                       placeholder="Python, Django, PostgreSQL, AWS, Docker">
                                <div class="form-text">ì‰¼í‘œ(,)ë¡œ êµ¬ë¶„í•˜ì—¬ ì…ë ¥í•˜ì„¸ìš”.</div>
                            </div>
                        </div>

                        <!-- í”„ë¡œì íŠ¸ ê¸°ê°„ ë° íŒ€ ì •ë³´ ì„¹ì…˜ -->
                        <div class="form-section mb-4">
                            <div class="section-header mb-3">
                                <h6 class="text-primary mb-0">
                                    <i class="fas fa-calendar me-1"></i>í”„ë¡œì íŠ¸ ì •ë³´
                                </h6>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="start_date" class="form-label">ì‹œì‘ì¼</label>
                                    <input type="date" class="form-control" id="start_date" name="start_date"
                                           value="{{ project.start_date.strftime('%Y-%m-%d') if project.start_date }}">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="end_date" class="form-label">ì¢…ë£Œì¼</label>
                                    <input type="date" class="form-control" id="end_date" name="end_date"
                                           value="{{ project.end_date.strftime('%Y-%m-%d') if project.end_date }}">
                                    <div class="form-check mt-2">
                                        <input class="form-check-input" type="checkbox" id="is_ongoing" name="is_ongoing"
                                               {{ 'checked' if not project.end_date }}>
                                        <label class="form-check-label" for="is_ongoing">
                                            ì§„í–‰ì¤‘ì¸ í”„ë¡œì íŠ¸
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="team_size" class="form-label">íŒ€ ê·œëª¨</label>
                                    <input type="number" class="form-control" id="team_size" name="team_size" 
                                           value="{{ project.team_size or '' }}" min="1" max="100">
                                </div>
                            </div>
                        </div>

                        <!-- ë§í¬ ë° URL ì„¹ì…˜ -->
                        <div class="form-section mb-4">
                            <div class="section-header mb-3">
                                <h6 class="text-primary mb-0">
                                    <i class="fas fa-link me-1"></i>ê´€ë ¨ ë§í¬
                                </h6>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="github_url" class="form-label">GitHub URL</label>
                                    <input type="url" class="form-control" id="github_url" name="github_url" 
                                           value="{{ project.github_url or '' }}">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="demo_url" class="form-label">ë°ëª¨/ë¼ì´ë¸Œ URL</label>
                                    <input type="url" class="form-control" id="demo_url" name="demo_url" 
                                           value="{{ project.demo_url or '' }}">
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="video_url" class="form-label">ë™ì˜ìƒ URL</label>
                                <input type="url" class="form-control" id="video_url" name="video_url" 
                                       value="{{ project.video_url or '' }}">
                            </div>
                        </div>

                        <!-- ì„±ê³¼ ë° ê²°ê³¼ ì„¹ì…˜ -->
                        <div class="form-section mb-4">
                            <div class="section-header mb-3">
                                <h6 class="text-primary mb-0">
                                    <i class="fas fa-trophy me-1"></i>ì„±ê³¼ ë° ê²°ê³¼
                                </h6>
                            </div>
                            
                            <div class="mb-3">
                                <label for="achievements" class="form-label">ì£¼ìš” ì„±ê³¼</label>
                                <textarea class="form-control" id="achievements" name="achievements" rows="4">{{ project.achievements or '' }}</textarea>
                            </div>
                            
                            <div class="mb-3">
                                <label for="metrics" class="form-label">ì •ëŸ‰ì  ì§€í‘œ</label>
                                <textarea class="form-control" id="metrics" name="metrics" rows="2">{{ project.metrics or '' }}</textarea>
                            </div>
                        </div>

                        <!-- ë¯¸ë””ì–´ ì—…ë¡œë“œ ì„¹ì…˜ -->
                        <div class="form-section mb-4">
                            <div class="section-header mb-3">
                                <h6 class="text-primary mb-0">
                                    <i class="fas fa-image me-1"></i>ë¯¸ë””ì–´ íŒŒì¼
                                </h6>
                            </div>
                            
                            {% if project.image_path %}
                            <div class="current-image mb-3">
                                <label class="form-label">í˜„ì¬ ì´ë¯¸ì§€</label>
                                <div class="card">
                                    <img src="{{ url_for('uploaded_file', filename=project.image_path) }}" 
                                         class="card-img-top" alt="í˜„ì¬ ì´ë¯¸ì§€" style="max-height: 200px; object-fit: cover;">
                                    <div class="card-body text-center">
                                        <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeCurrentImage()">
                                            <i class="fas fa-trash me-1"></i>í˜„ì¬ ì´ë¯¸ì§€ ì‚­ì œ
                                        </button>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                            
                            <div class="mb-3">
                                <label for="image" class="form-label">ìƒˆ ì´ë¯¸ì§€ ì—…ë¡œë“œ</label>
                                <input type="file" class="form-control" id="image" name="image" accept="image/*">
                                <div class="form-text">ìƒˆ ì´ë¯¸ì§€ë¥¼ ì„ íƒí•˜ë©´ ê¸°ì¡´ ì´ë¯¸ì§€ê°€ êµì²´ë©ë‹ˆë‹¤.</div>
                            </div>
                        </div>

                        <!-- ê³µê°œ ì„¤ì • ì„¹ì…˜ -->
                        <div class="form-section mb-4">
                            <div class="section-header mb-3">
                                <h6 class="text-primary mb-0">
                                    <i class="fas fa-cog me-1"></i>ê³µê°œ ì„¤ì •
                                </h6>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="is_featured" name="is_featured"
                                               {{ 'checked' if project.is_featured }}>
                                        <label class="form-check-label" for="is_featured">
                                            <i class="fas fa-star text-warning me-1"></i>ì£¼ìš” í”„ë¡œì íŠ¸ë¡œ ì„¤ì •
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="is_public" name="is_public"
                                               {{ 'checked' if project.is_public }}>
                                        <label class="form-check-label" for="is_public">
                                            <i class="fas fa-eye text-success me-1"></i>ê³µê°œ í”„ë¡œì íŠ¸
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <label for="sort_order" class="form-label">ì •ë ¬ ìˆœì„œ</label>
                                    <input type="number" class="form-control" id="sort_order" name="sort_order" 
                                           value="{{ project.sort_order or 0 }}" min="0">
                                </div>
                            </div>
                        </div>

                        <!-- ì œì¶œ ë²„íŠ¼ -->
                        <div class="d-flex justify-content-between">
                            <a href="{{ url_for('admin') }}" class="btn btn-outline-secondary">
                                <i class="fas fa-times me-1"></i>ì·¨ì†Œ
                            </a>
                            <div>
                                <a href="{{ url_for('project_detail', project_id=project.id) }}" 
                                   class="btn btn-outline-info me-2" target="_blank">
                                    <i class="fas fa-eye me-1"></i>ë¯¸ë¦¬ë³´ê¸°
                                </a>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save me-1"></i>ìˆ˜ì • ì™„ë£Œ
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- ì‚¬ì´ë“œë°” -->
        <div class="col-lg-4">
            <!-- í”„ë¡œì íŠ¸ ì •ë³´ -->
            <div class="card shadow mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-info-circle me-2"></i>í”„ë¡œì íŠ¸ ì •ë³´
                    </h5>
                </div>
                <div class="card-body">
                    <div class="info-item mb-3">
                        <strong>í”„ë¡œì íŠ¸ ID:</strong> {{ project.id }}
                    </div>
                    <div class="info-item mb-3">
                        <strong>ë“±ë¡ì¼:</strong> {{ project.created_at.strftime('%Yë…„ %mì›” %dì¼') }}
                    </div>
                    <div class="info-item mb-3">
                        <strong>ì¡°íšŒìˆ˜:</strong> {{ project.view_count or 0 }}íšŒ
                    </div>
                    <div class="info-item">
                        <strong>ìƒíƒœ:</strong> 
                        {% if project.is_public %}
                            <span class="badge bg-success">ê³µê°œ</span>
                        {% else %}
                            <span class="badge bg-secondary">ë¹„ê³µê°œ</span>
                        {% endif %}
                        {% if project.is_featured %}
                            <span class="badge bg-warning">ì£¼ìš”í”„ë¡œì íŠ¸</span>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- ìˆ˜ì • ê°€ì´ë“œ -->
            <div class="card shadow">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-lightbulb me-2"></i>ìˆ˜ì • ê°€ì´ë“œ
                    </h5>
                </div>
                <div class="card-body">
                    <div class="guide-item mb-3">
                        <h6 class="text-primary">ğŸ“ ë‚´ìš© ì‘ì„± íŒ</h6>
                        <ul class="small text-muted mb-0">
                            <li>êµ¬ì²´ì ì¸ ì„±ê³¼ ìˆ˜ì¹˜ í¬í•¨</li>
                            <li>ì‚¬ìš©í•œ ê¸°ìˆ ì˜ ë²„ì „ ëª…ì‹œ</li>
                            <li>ë¬¸ì œ í•´ê²° ê³¼ì • ì„¤ëª…</li>
                        </ul>
                    </div>
                    
                    <div class="guide-item mb-3">
                        <h6 class="text-success">ğŸ–¼ï¸ ì´ë¯¸ì§€ ì—…ë¡œë“œ</h6>
                        <ul class="small text-muted mb-0">
                            <li>ê¶Œì¥ í•´ìƒë„: 1200px ì´ìƒ</li>
                            <li>ì§€ì› í˜•ì‹: JPG, PNG, GIF</li>
                            <li>ìµœëŒ€ í¬ê¸°: 10MB</li>
                        </ul>
                    </div>
                    
                    <div class="guide-item">
                        <h6 class="text-info">ğŸ”— ë§í¬ ê´€ë¦¬</h6>
                        <ul class="small text-muted mb-0">
                            <li>GitHub: ì†ŒìŠ¤ì½”ë“œ ê³µê°œì‹œë§Œ</li>
                            <li>Demo: ì‹¤ì œ ë™ì‘í•˜ëŠ” ë§í¬ë§Œ</li>
                            <li>ì •ê¸°ì ì¸ ë§í¬ ìƒíƒœ í™•ì¸</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<style>
.form-section {
    border-bottom: 1px solid #eee;
    padding-bottom: 20px;
}

.section-header {
    border-left: 4px solid var(--accent-color);
    padding-left: 15px;
    background: rgba(103, 126, 234, 0.05);
    padding: 10px 15px;
    border-radius: 5px;
}

.current-image .card {
    max-width: 300px;
}

.info-item {
    padding: 8px 0;
    border-bottom: 1px solid #eee;
}

.info-item:last-child {
    border-bottom: none;
}

.guide-item {
    padding-bottom: 15px;
}

.guide-item:last-child {
    padding-bottom: 0;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('editProjectForm');
    
    // ì§„í–‰ì¤‘ ì²´í¬ë°•ìŠ¤ ì²˜ë¦¬
    const isOngoingCheckbox = document.getElementById('is_ongoing');
    const endDateInput = document.getElementById('end_date');
    
    isOngoingCheckbox.addEventListener('change', function() {
        if (this.checked) {
            endDateInput.value = '';
            endDateInput.disabled = true;
        } else {
            endDateInput.disabled = false;
        }
    });
    
    // ì´ˆê¸° ìƒíƒœ ì„¤ì •
    if (isOngoingCheckbox.checked) {
        endDateInput.disabled = true;
    }
    
    // í¼ ì œì¶œ ì²˜ë¦¬
    form.addEventListener('submit', function(e) {
        const submitBtn = this.querySelector('button[type="submit"]');
        const originalText = submitBtn.innerHTML;
        
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>ìˆ˜ì • ì¤‘...';
        submitBtn.disabled = true;
        
        // í¼ì´ ì œì¶œë˜ì§€ ì•Šìœ¼ë©´ ë²„íŠ¼ ìƒíƒœ ë³µì›
        setTimeout(() => {
            if (submitBtn.disabled) {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        }, 10000);
    });
});

function removeCurrentImage() {
    if (confirm('í˜„ì¬ ì´ë¯¸ì§€ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        // ì´ë¯¸ì§€ ì‚­ì œë¥¼ ìœ„í•œ hidden input ì¶”ê°€
        const form = document.getElementById('editProjectForm');
        const hiddenInput = document.createElement('input');
        hiddenInput.type = 'hidden';
        hiddenInput.name = 'remove_image';
        hiddenInput.value = 'true';
        form.appendChild(hiddenInput);
        
        // í˜„ì¬ ì´ë¯¸ì§€ ì˜ì—­ ìˆ¨ê¸°ê¸°
        document.querySelector('.current-image').style.display = 'none';
        
        alert('ìˆ˜ì • ì™„ë£Œ ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ì´ë¯¸ì§€ê°€ ì‚­ì œë©ë‹ˆë‹¤.');
    }
}
</script>
{% endblock %}